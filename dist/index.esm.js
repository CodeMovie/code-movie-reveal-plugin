(()=>{var s=Object.defineProperty,o=(t,e,n)=>e in t?s(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,a=(t,e,n)=>(o(t,typeof e!="symbol"?e+"":e,n),n),i=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)},r=(t,e,n)=>(i(t,e,"read from private field"),n?n.call(t):e.get(t)),u=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},l=(t,e,n,f)=>(i(t,e,"write to private field"),f?f.call(t,n):e.set(t,n),n);function E(t){return Array.from(new Set(t))}function b(t){let e=Math.round(Number(t));return Number.isFinite(e)&&!Number.isNaN(e)?e:0}function y(t){return Math.abs(b(t))}function A(t){return t?String(t).split(/\s+/).map(y).sort((e,n)=>e-n):[]}var h,p,c,m,d,w=class extends HTMLElement{constructor(){super(),u(this,h,this.attachShadow({mode:"open"})),u(this,p,void 0),u(this,c,[]),u(this,m,0),u(this,d,null),a(this,"_handleClick",f=>{if(f.type==="click"){for(let g of f.composedPath())if(g instanceof HTMLElement){if(g.getAttribute("data-command")==="next"){this.next();return}if(g.getAttribute("data-command")==="prev"){this.prev();return}}}});let[t,e,n]=w._template();l(this,p,t),r(this,h).append(t,e,n)}static _template(){let t=document.createElement("slot"),e=document.createElement("slot");e.name="controls",e.innerHTML=`
      <div part="controls" class="defaultControls">
        <button part="controls-prevBtn" data-command="prev">
          <span>&lt;</span>
        </button>
        <button part="controls-nextBtn" data-command="next">
          <span>&gt;</span>
        </button>
      </div>
    `;let n=document.createElement("style");return n.innerHTML=`
      :host { display: grid; }
      :host(:not([controls])) slot[name=controls] { display: none }
      .defaultControls { position: relative; z-index: 1337; }
    `,[t,e,n]}static get observedAttributes(){return["keyframes","current"]}attributeChangedCallback(t,e,n){e!==n&&(t==="keyframes"?(l(this,c,A(n)),this._goToCurrent()):t==="current"&&(l(this,m,this._toKeyframeIdx(n)),this._goToCurrent()))}get controls(){return this.hasAttribute("controls")}set controls(t){t?this.setAttribute("controls","controls"):this.removeAttribute("controls")}get keyframes(){return r(this,c)}set keyframes(t){Array.isArray(t)?(t=E(t.map(y).sort((e,n)=>e-n)),this.setAttribute("keyframes",t.join(" ")),l(this,c,t)):(this.removeAttribute("keyframes"),l(this,c,[])),this._goToCurrent()}_toKeyframeIdx(t){let e=b(t);return e<0&&(e=Math.abs(e)-1),e>this.maxFrame&&(e=this.maxFrame),r(this,c).indexOf(e)}get current(){return r(this,c)[r(this,m)]||0}set current(t){let e=this._toKeyframeIdx(t);e!==-1?(l(this,m,e),this.setAttribute("current",String(r(this,c)[e]))):(l(this,m,0),this.setAttribute("current","0"))}get nextCurrent(){return r(this,d)&&r(this,c)[r(this,m)]||null}get maxFrame(){return Math.max(...this.keyframes)}_goToCurrent(){let t=r(this,m);t in r(this,c)||(r(this,c).length>=1&&t<0?t=r(this,c).length-1:t=0),l(this,d,t);let e=this.dispatchEvent(new Event("cm-beforeframechange",{bubbles:!0,cancelable:!0}));l(this,d,null),e&&(this._setClass(r(this,c)[t]),t!==r(this,m)&&l(this,m,t),this.dispatchEvent(new Event("cm-afterframechange",{bubbles:!0})))}_setClass(t){let e=r(this,p).assignedElements()[0];if(e){for(let n of e.classList)/^frame[0-9]+$/.test(n)&&e.classList.remove(n);e.classList.add(`frame${t}`)}}next(){return l(this,m,r(this,m)+1),this._goToCurrent(),this.current}prev(){return l(this,m,r(this,m)-1),this._goToCurrent(),this.current}connectedCallback(){r(this,h).addEventListener("click",this._handleClick)}disconnectedCallback(){r(this,h).removeEventListener("click",this._handleClick)}},k=w;h=new WeakMap,p=new WeakMap,c=new WeakMap,m=new WeakMap,d=new WeakMap,window.customElements.get("code-movie-runtime")??window.customElements.define("code-movie-runtime",k)})();var C=new WeakMap;function x(s){let o=[];for(let a=0;a<s.maxFrame;a++){let i=document.createElement("span");i.className="fragment code-movie-plugin-fragment",s.after(i),o.push(i)}C.set(s,o)}function M(s,o){let a=s.querySelectorAll("code-movie-runtime");for(let i of a)x(i),o.syncFragments()}function v(s,o){return s?s.matches(".code-movie-plugin-fragment")?v(s.previousElementSibling,o+1):s.matches("code-movie-runtime")?[s,o]:null:null}function T(s){new MutationObserver(o=>{for(let a of o)if(a.type==="childList"){for(let i of a.addedNodes)i.nodeType===1&&i.matches("code-movie-runtime")&&(x(i),s.syncFragments());for(let i of a.removedNodes)if(i.nodeType===1&&i.matches("code-movie-runtime")){let r=C.get(i)??[];for(let u of r)u.remove();s.syncFragments()}}}).observe(document.querySelector(".slides"),{subtree:!0,childList:!0})}function _(){return{id:"code-movie",init:s=>{s.on("ready",async()=>{await window.customElements.whenDefined("code-movie-runtime");for(let o of s.getSlides())M(o,s);T(s)}),s.on("fragmentshown",o=>{let a=v(o.fragment,0);if(!a)return;let[i,r]=a;i.current=r}),s.on("fragmenthidden",o=>{let a=v(o.fragment,-1);if(!a)return;let[i,r]=a;i.current=r})}}}globalThis.CodeMovie=_;export{_ as CodeMovie};
