(()=>{var i=Object.defineProperty,s=(t,e,n)=>e in t?i(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,l=(t,e,n)=>(s(t,typeof e!="symbol"?e+"":e,n),n),c=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)},r=(t,e,n)=>(c(t,e,"read from private field"),n?n.call(t):e.get(t)),u=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},m=(t,e,n,f)=>(c(t,e,"write to private field"),f?f.call(t,n):e.set(t,n),n);function C(t){return Array.from(new Set(t))}function v(t){let e=Math.round(Number(t));return Number.isFinite(e)&&!Number.isNaN(e)?e:0}function y(t){return Math.abs(v(t))}function x(t){return t?String(t).split(/\s+/).map(y).sort((e,n)=>e-n):[]}var h,p,a,o,d,w=class extends HTMLElement{constructor(){super(),u(this,h,this.attachShadow({mode:"open"})),u(this,p,void 0),u(this,a,[]),u(this,o,0),u(this,d,null),l(this,"_handleClick",f=>{if(f.type==="click"){for(let g of f.composedPath())if(g instanceof HTMLElement){if(g.getAttribute("data-command")==="next"){this.next();return}if(g.getAttribute("data-command")==="prev"){this.prev();return}}}});let[t,e,n]=w._template();m(this,p,t),r(this,h).append(t,e,n)}static _template(){let t=document.createElement("slot"),e=document.createElement("slot");e.name="controls",e.innerHTML=`
      <div part="controls" class="defaultControls">
        <button part="controls-prevBtn" data-command="prev">
          <span>&lt;</span>
        </button>
        <button part="controls-nextBtn" data-command="next">
          <span>&gt;</span>
        </button>
      </div>
    `;let n=document.createElement("style");return n.innerHTML=`
      :host { display: grid; }
      :host(:not([controls])) slot[name=controls] { display: none }
      .defaultControls { position: relative; z-index: 1337; }
    `,[t,e,n]}static get observedAttributes(){return["keyframes","current"]}attributeChangedCallback(t,e,n){e!==n&&(t==="keyframes"?(m(this,a,x(n)),this._goToCurrent()):t==="current"&&(m(this,o,this._toKeyframeIdx(n)),this._goToCurrent()))}get controls(){return this.hasAttribute("controls")}set controls(t){t?this.setAttribute("controls","controls"):this.removeAttribute("controls")}get keyframes(){return r(this,a)}set keyframes(t){Array.isArray(t)?(t=C(t.map(y).sort((e,n)=>e-n)),this.setAttribute("keyframes",t.join(" ")),m(this,a,t)):(this.removeAttribute("keyframes"),m(this,a,[])),this._goToCurrent()}_toKeyframeIdx(t){let e=v(t);return e<0&&(e=Math.abs(e)-1),e>this.maxFrame&&(e=this.maxFrame),r(this,a).indexOf(e)}get current(){return r(this,a)[r(this,o)]||0}set current(t){let e=this._toKeyframeIdx(t);e!==-1?(m(this,o,e),this.setAttribute("current",String(r(this,a)[e]))):(m(this,o,0),this.setAttribute("current","0"))}get nextCurrent(){return r(this,d)&&r(this,a)[r(this,o)]||null}get maxFrame(){return Math.max(...this.keyframes)}_goToCurrent(){let t=r(this,o);t in r(this,a)||(r(this,a).length>=1&&t<0?t=r(this,a).length-1:t=0),m(this,d,t);let e=this.dispatchEvent(new Event("cm-beforeframechange",{bubbles:!0,cancelable:!0}));m(this,d,null),e&&(this._setClass(r(this,a)[t]),t!==r(this,o)&&m(this,o,t),this.dispatchEvent(new Event("cm-afterframechange",{bubbles:!0})))}_setClass(t){let e=r(this,p).assignedElements()[0];if(e){for(let n of e.classList)/^frame[0-9]+$/.test(n)&&e.classList.remove(n);e.classList.add(`frame${t}`)}}next(){return m(this,o,r(this,o)+1),this._goToCurrent(),this.current}prev(){return m(this,o,r(this,o)-1),this._goToCurrent(),this.current}connectedCallback(){r(this,h).addEventListener("click",this._handleClick)}disconnectedCallback(){r(this,h).removeEventListener("click",this._handleClick)}},E=w;h=new WeakMap,p=new WeakMap,a=new WeakMap,o=new WeakMap,d=new WeakMap,window.customElements.get("code-movie-runtime")??window.customElements.define("code-movie-runtime",E)})();function k(i){for(let s=0;s<i.maxFrame;s++){let l=document.createElement("span");l.className="fragment animation-plugin-fragment",i.after(l)}}function A(i,s){let l=i.querySelectorAll("code-movie-runtime");for(let c of l)k(c,s),s.syncFragments()}function b(i,s){return i?i.matches(".animation-plugin-fragment")?b(i.previousElementSibling,s+1):i.matches("code-movie-runtime")?[i,s]:null:null}function _(){return{id:"code-movie",init:i=>{i.on("ready",async()=>{await window.customElements.whenDefined("code-movie-runtime");for(let s of i.getSlides())A(s,i)}),i.on("fragmentshown",s=>{let l=b(s.fragment,0);if(!l)return;let[c,r]=l;c.current=r}),i.on("fragmenthidden",s=>{let l=b(s.fragment,-1);if(!l)return;let[c,r]=l;c.current=r})}}}globalThis.CodeMovie=_;export{_ as CodeMovie};
